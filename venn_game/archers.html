<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&display=swap" rel="stylesheet">
  <title>Image Quiz</title>
  <style>
    
    body {
      display: flex;
      flex-direction: column;
    }

    .main-content {
      display: flex;
      margin-top: 100px;
      gap: 20px;
      padding: 20px;
    }

    #toolbox {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 12px;
      border: 2px solid #848484;
      padding: 16px;
      width: fit-content;
      max-width: 200px;
      max-height: 400px;
      overflow: auto;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    #toolbox img {
      width: 48px;
      height: 48px;
      cursor: grab;
    }

    #container {
      position: relative;
      display: inline-block;
    }

    #mainImage {
      display: block;
      max-width: 800px;
    }

    .dropped-icon {
      position: absolute;
      width: 48px;
      height: 48px;
      cursor: grab;
      pointer-events: auto;
    }

    #scoreboard {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: white;
      padding: 10px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 10px;
    }

    .zone {
      position: absolute;
      border: .5px dashed rgb(0, 0, 0);
      background-color: rgba(255, 255, 255, 0.10);
      pointer-events: none;
    }

    .zone-dot {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 6px;
      height: 6px;
      background-color: blue;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <div class="navcontainer">
    <nav class="topnav">
      <a href="../index.html">Tournaments</a>
      <a href="../images.html">Images</a>
      <a href="../links.html">Resources</a>
      <a href="https://forms.gle/yHM5ecGqhnZP33KF8">Create Event</a>
    </nav>
  </div>
  <div>
    <div class="main-content">
      <div>
        <div id="toolbox"></div>
        <p style="margin-top: 10px; font-size: 10px; color: #ffffff; max-width: 200px;">
          <i class="bi bi-info-circle"></i> Icons are reusable for outter circles
        </p>
      </div>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <div id="container" style="position: relative;">
          <img id="mainImage" src="https://ik.imagekit.io/aoe2tournaments/Archer.jpg" alt="Main" />
          <div id="scoreboard">
            <div>Score: <span id="score">0</span> / <span id="total">0</span></div>
            <button onclick="checkScore()">Check Score</button>
          </div>
        </div>
        <a class="button" href="/venn_game">More Games</a>
      </div>
    </div>

    <script>
const sheetUrl = 'https://docs.google.com/spreadsheets/d/1yVp_GU1SvMkBlaf-G8tLWSoEJYd1amEGLEGYuRc41FI/gviz/tq?tqx=out:csv&gid=462747075';

Papa.parse(sheetUrl, {
  download: true,
  header: true,
  complete: function(results) {
    console.log("Parsed rows:");
    results.data.forEach((row, index) => {
      console.log(`Row ${index + 1}:`, row);
    });
  },
  error: function(err) {
    console.error("Error loading sheet:", err);
  }
});

      const toolbox = document.getElementById('toolbox');
      const container = document.getElementById('container');
      const scoreEl = document.getElementById('score');
      const totalEl = document.getElementById('total');

      const targetZones = [
        { name: 'CivIcon-Persians.webp', x: 370, y: 500, width: 60, height: 60 },
        { name: 'CivIcon-Incas.webp', x: 370, y: 320, width: 60, height: 60 },
        { name: 'CivIcon-Spanish.webp', x: 435, y: 420, width: 60, height: 60 },
        { name: 'CivIcon-Malians.webp', x: 295, y: 420, width: 60, height: 60 },
        { name: 'CivIcon-Britons.webp', x: 440, y: 250, width: 60, height: 60 },
        { name: 'CivIcon-Mongols.webp', x: 295, y: 250, width: 60, height: 60 },
        { name: 'CivIcon-Aztecs.webp', x: 370, y: 175, width: 60, height: 60 },
        { name: 'CivIcon-Huns.webp', x: 210, y: 200, width: 60, height: 60 },
        { name: 'CivIcon-Burmese.webp', x: 290, y: 130, width: 60, height: 60 },
        { name: 'CivIcon-Franks.webp', x: 55, y: 130, width: 60, height: 60 },
        { name: 'CivIcon-Teutons.webp', x: 575, y: 370, width: 60, height: 60 },
        { name: 'CivIcon-Goths.webp', x: 500, y: 370, width: 60, height: 60 }
      ];

      totalEl.textContent = targetZones.length;
      let placedIcons = [];
      const icons = [...new Set(targetZones.map(z => z.name))];
      icons.forEach(name => {
        const icon = document.createElement('img');
        icon.src = `../icons/${name}`;
        icon.draggable = true;
        icon.dataset.icon = name;
        toolbox.appendChild(icon);
      });

      targetZones.forEach(zone => {
        const div = document.createElement('div');
        div.className = 'zone';
        div.style.left = `${zone.x}px`;
        div.style.top = `${zone.y}px`;
        div.style.width = `${zone.width}px`;
        div.style.height = `${zone.height}px`;

        const dot = document.createElement('div');
        dot.className = 'zone-dot';
        div.appendChild(dot);
        container.appendChild(div);
      });

      toolbox.addEventListener('dragstart', e => {
        if (e.target.tagName === 'IMG') {
          e.dataTransfer.setData('icon', e.target.dataset.icon);
        }
      });

      container.addEventListener('dragover', e => {
        e.preventDefault();
      });

      container.addEventListener('drop', e => {
        e.preventDefault();
        const iconName = e.dataTransfer.getData('icon');
        const oldX = e.dataTransfer.getData('snappedX');
        const oldY = e.dataTransfer.getData('snappedY');
        if (!iconName) return;

        const rect = container.getBoundingClientRect();
        const dropX = e.clientX - rect.left;
        const dropY = e.clientY - rect.top;

        let snappedZone = null;
        for (const zone of targetZones) {
          if (
            dropX >= zone.x &&
            dropX <= zone.x + zone.width &&
            dropY >= zone.y &&
            dropY <= zone.y + zone.height
          ) {
            snappedZone = zone;
            break;
          }
        }

        if (snappedZone) {
          placedIcons = placedIcons.filter(existing => {
            if (
              existing.dataset.snappedX === String(snappedZone.x) &&
              existing.dataset.snappedY === String(snappedZone.y)
            ) {
              container.removeChild(existing);
              return false;
            }
            return true;
          });

          if (oldX && oldY) {
            placedIcons = placedIcons.filter(existing => {
              if (
                existing.dataset.snappedX === oldX &&
                existing.dataset.snappedY === oldY &&
                existing.dataset.icon === iconName
              ) {
                container.removeChild(existing);
                return false;
              }
              return true;
            });
          }

          const img = document.createElement('img');
          img.src = `../icons/${iconName}`;
          img.className = 'dropped-icon';
          img.dataset.icon = iconName;
          img.dataset.snappedX = snappedZone.x;
          img.dataset.snappedY = snappedZone.y;
          img.draggable = true;
          img.style.left = `${snappedZone.x + snappedZone.width / 2 - 24}px`;
          img.style.top = `${snappedZone.y + snappedZone.height / 2 - 24}px`;

          img.addEventListener('click', () => {
            container.removeChild(img);
            placedIcons = placedIcons.filter(i => i !== img);
          });

          img.addEventListener('dragstart', e => {
            e.dataTransfer.setData('icon', img.dataset.icon);
            e.dataTransfer.setData('snappedX', img.dataset.snappedX);
            e.dataTransfer.setData('snappedY', img.dataset.snappedY);
          });

          container.appendChild(img);
          placedIcons.push(img);
        }
      });

      container.addEventListener('dragend', e => {
        if (!e.dataTransfer.dropEffect && e.target.classList.contains('dropped-icon')) {
          container.removeChild(e.target);
          placedIcons = placedIcons.filter(img => img !== e.target);
        }
      });

      function checkScore() {
        let correct = 0;

        placedIcons.forEach(img => {
          const snappedX = Number(img.dataset.snappedX);
          const snappedY = Number(img.dataset.snappedY);

          const matched = targetZones.some(z =>
            z.name === img.dataset.icon &&
            z.x === snappedX &&
            z.y === snappedY
          );

          if (matched) {
            img.style.border = '2px solid green';
            correct++;
          } else {
            img.style.border = '2px solid red';
          }
        });

        scoreEl.textContent = correct;
      }
    </script>
</body>
</html>
